### Пример для триггеров уровня строки (FOR EACH ROW)
CREATE OR REPLACE FUNCTION public.func_before_row_employees()
RETURNS TRIGGER
AS
$$
DECLARE
	v_row RECORD;
	v_log TEXT;
BEGIN
	-- Выполняем действие в зависимости от типа операции
	CASE TG_OP
		WHEN 'INSERT' THEN
			v_row := NEW;
			v_log := NEW::TEXT;
		WHEN 'DELETE' THEN
			v_row := OLD;
			v_log := OLD::TEXT;
		WHEN 'UPDATE' THEN
			v_row := NEW;
			v_log := OLD::TEXT || '->' || NEW::TEXT;
	END CASE;
	-- Выводим информацию в консоль
	RAISE NOTICE '% % %: %', TG_WHEN, TG_OP, TG_LEVEL, v_log;
	-- Возвращаем переменную в триггер
	RETURN v_row;
END;
$$ LANGUAGE plpgsql;


### Пример для триггеров уровня оператора (FOR EACH STATEMENT)
CREATE OR REPLACE TRIGGER trg_before_row_employees
BEFORE DELETE OR INSERT OR UPDATE
ON public.employees
FOR EACH ROW
EXECUTE FUNCTION func_before_row_employees();

CREATE OR REPLACE FUNCTION public.func_before_statement_employees()
RETURNS TRIGGER
AS
$$
BEGIN
	-- Инициируем исключение для прекращения операции
	RAISE EXCEPTION 'Запрещено использовать % для таблицы %.%', TG_OP, TG_TABLE_SCHEMA, TG_TABLE_NAME;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE TRIGGER trg_before_statement_employees
BEFORE DELETE OR INSERT OR UPDATE OR TRUNCATE
ON public.employees
FOR EACH STATEMENT
EXECUTE FUNCTION func_before_statement_employees();


### Пример для триггеров уровня строки (FOR EACH ROW)
CREATE OR REPLACE FUNCTION public.func_v_indexing_employees()
RETURNS TRIGGER
AS
$$
DECLARE
	v_row RECORD;
	v_log TEXT;
BEGIN
	-- Выполняем действие в зависимости от типа операции
	CASE TG_OP
		WHEN 'INSERT' THEN
			INSERT INTO public.employees (tab_num, full_name, salary)
			VALUES(NEW.tab_num, NEW.full_name, NEW.salary);
			v_row := NEW;
			v_log := NEW::TEXT;
		WHEN 'DELETE' THEN
			DELETE FROM public.employees
			WHERE tab_num = OLD.tab_num;
			v_row := OLD;
			v_log := CONCAT('(',OLD.tab_num,')');
		WHEN 'UPDATE' THEN
			UPDATE public.employees
			SET salary = NEW.salary
			WHERE tab_num = OLD.tab_num;
			v_row := NEW;
			v_log :=  CONCAT('(',OLD.tab_num,',',OLD.salary,')') || '->' || CONCAT('(',NEW.tab_num,',',NEW.salary,')');
	END CASE;
	-- Выводим информацию в консоль
	RAISE NOTICE '% % %: %', TG_WHEN, TG_OP, TG_LEVEL, v_log;
	-- Возвращаем переменную в триггер
	RETURN v_row;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE TRIGGER trg_v_indexing_employees
INSTEAD OF UPDATE OR DELETE OR INSERT
ON public.v_indexing_employees
FOR EACH ROW
EXECUTE FUNCTION func_v_indexing_employees();
